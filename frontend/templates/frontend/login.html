{% extends 'frontend/base.html' %}

{% block title %}Login{% endblock %}

{% block content %}
<h1>Login</h1>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Login</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(form);
            fetch('/api/users/login/', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.token) {
                        // Set token in cookie
                        document.cookie = `auth_token=${data.token}; path=/`;
                        window.location.href = '/';
                    } else {
                        alert('Login failed');
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    });
</script>
{% endblock %}